-------------------------------------------------------------------------------------------------------------------------------------
-- Query to refresh records into table doz_mfm_customer.doz_rounding_action_plan.
-------------------------------------------------------------------------------------------------------------------------------------

USE doz_mfm_customer;

TRUNCATE TABLE doz_mfm_customer.doz_rounding_action_plan;

INSERT INTO doz_mfm_customer.doz_rounding_action_plan SELECT '' AS standardLineItemNum, '' AS EP, rndLbrItm.libraryitem AS Element_Of_Performance_Requirement, rndFnd.Comments AS Comments_Deficiencies, REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(rndFnd.resolutionNotes, '<p>', ''), '</p>', ''), '\&quot\073', ''), '\&nbsp\073', '  '), '<br>', ''), '</br>', ''), '<strong>', ''), '</strong>', '') AS Action_Plan, wrkodr.WoNumber AS Work_Order_Number,  rndFnd.dateCreated AS Sched_Start_Date, '' AS Sched_Comp_Date, CASE   WHEN rndFnd.idRoundStatus = 0 THEN 'In Progress'   WHEN rndFnd.idRoundStatus = 1 THEN 'In Progress'   WHEN rndFnd.idRoundStatus = 2 THEN 'Resolved'   WHEN rndFnd.idRoundStatus = 3 THEN 'Resolved' END AS RoundStatus, rnds.idCustomerSegment AS idCustomerSegment, lctn.IdCostCenter AS IdCostCenter, cstCntr1.CostCenterDescription AS CostCenterDescription, rnds.IdCostCenter AS IdDepartment, cstCntr2.CostCenterDescription AS DepartmentName, rnds.IdRound AS IdRound, rnds.IDLocation AS IdLocation, rndTemp.Roundname AS RoundName, stts.statusdescription AS WOStatusDescription, rnds.deleted AS roundDeleted FROM dsz_mfm_cms.dsz_tblRoundFindings rndFnd JOIN dsz_mfm_cms.dsz_tblRounds rnds ON rnds.IDRound = rndFnd.IDRound JOIN dsz_mfm_cms.dsz_tblRoundTemplates rndTemp  ON rnds.IDRoundTemplate = rndTemp.IDRoundTemplate JOIN dsz_mfm_cms.dsz_Location lctn ON rndFnd.IDLocation = lctn.IDLocation JOIN dsz_mfm_cms.dsz_tblRoundLibraryItems rndLbrItm  ON rndFnd.IDRoundLibraryItem = rndLbrItm.IDRoundLibraryItem LEFT OUTER JOIN dsz_mfm_cms.dsz_tblRoundLibraries rndLbr ON rndFnd.IDRoundLibraryItem = rndLbr.IDRoundLibrary LEFT OUTER JOIN dsz_mfm_cms.dsz_CostCenter cstCntr1 ON lctn.IDCostCenter = cstCntr1.IDCostCenter LEFT OUTER JOIN dsz_mfm_cms.dsz_CostCenter cstCntr2 ON rnds.IDCostCenter = cstCntr2.IDCostCenter LEFT OUTER JOIN dsz_mfm_cms.dsz_workorder wrkodr ON rndFnd.IdWorkOrder = wrkodr.IdWorkOrder LEFT OUTER JOIN dsz_mfm_cms.dsz_status stts on wrkodr.idWOStatus=stts.idStatus WHERE rndTemp.RoundName like 'CSHA%';